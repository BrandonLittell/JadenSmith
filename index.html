<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>JadenSmith</title>
    <script src="http://code.jquery.com/jquery.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Josefin+Slab' rel='stylesheet' type='text/css'>   
     <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <style>
    body {
        font-family: 'Josefin Slab', serif;
        font-size: 48px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="span12">
          <canvas id="myCanvas" width="400" height="400"></canvas>
          <h1>Cool Html Template!</h1>
        </div>
        <form class="form-inline">
          <div class="form-group">
            <label class="sr-only" for="exampleInputAmount">Enter twitter username</label>
              <div class="input-group">
                <div class="input-group-addon">@</div>
                <input type="text" class="form-control" id="userName" value="officaljaden">
              </div>
          </div>
          <button type="submit" class="btn btn-primary" onclick="searchTweets()">Search</button>
        </form>
      </div>
    </div>

<script>
var ImageGenerator = new Object();
ImageGenerator.init = function() {
  this.canvas = document.getElementById("myCanvas");
  this.context = this.canvas.getContext("2d");
  this.imageWidth = 400;
  this.imageHeight = 400;
  this.textPadding = 20;
}
ImageGenerator.generate = function(tweetText, authorText, imageSrc) {
  var _this = this;
  _this.imageObj = new Image();
  this.imageObj.onload = function(){
    _this.context.drawImage(_this.imageObj, 0, 0, _this.imageWidth, _this.imageHeight);
    _this.context.font = "30px Georgia";
    _this.context.fillStyle = "white";

    // Write Text
    wrapText(_this.context, tweetText, _this.textPadding, 60, _this.imageWidth - (_this.textPadding * 2), 35);
    _this.context.fillText(authorText, 40, 350);
  };
  
  _this.imageObj.src = imageSrc; 
}

//TODO should be triggered by search
window.onload = function(){
  var tweet = "Wishing you weren't dutch? #itsbecauseurdutch";
  var user = "@brandon_littell";
  var image = "https://scontent.cdninstagram.com/hphotos-xfa1/t51.2885-15/s640x640/e35/sh0.08/11355905_1618613161745444_1921259379_n.jpg";

  ImageGenerator.init();
  ImageGenerator.generate(tweet, user, image);
};

// From: http://www.html5canvastutorials.com/tutorials/html5-canvas-wrap-text-tutorial/
function wrapText(context, text, x, y, maxWidth, lineHeight) {
  var words = text.split(' ');
  var line = '';

  for(var n = 0; n < words.length; n++) {
    var testLine = line + words[n] + ' ';
    var metrics = context.measureText(testLine);
    var testWidth = metrics.width;
    if (testWidth > maxWidth && n > 0) {
      context.fillText(line, x, y);
      line = words[n] + ' ';
      y += lineHeight;
    }
    else {
      line = testLine;
    }
  }
  context.fillText(line, x, y);
}

</script>
</body>
</html>