<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>JadenSmith</title>
    <script src="http://code.jquery.com/jquery.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Josefin+Slab' rel='stylesheet' type='text/css'>   
     <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <style>
    body {
        font-family: 'Josefin Slab', serif;
        font-size: 48px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="span12">
          <h1>Cool Html Template!</h1>
        </div>
        <form class="form-inline">
          <div class="form-group">
            <label class="sr-only">Enter twitter username</label>
              <div class="input-group">
                <div class="input-group-addon">@</div>
                <input type="text" class="form-control" id="userName" value="officaljaden">
              </div>
          </div>
          <button type="button" class="btn btn-primary" id ="searchButton">Search</button>
        </form>
        <div id = "images">
          <canvas id="myCanvas" width="400" height="400"></canvas>
          <br>
          <button type="button" class="btn btn-primary" id ="newImage">New Image</button>
          <div class="btn-group" role="group" aria-label="...">
            <button type="button" class="btn btn-primary active" id ="justifyLeft">Left</button>
            <button type="button" class="btn btn-primary" id ="justifyCenter">Center</button>
            <button type="button" class="btn btn-primary" id ="justifyRight">Right</button>
          </div>
        </div>
        <br>
      </div>
    </div>

<script>
var LEFT = true;
var RIGHT = false;
$('#images').hide();
$('#searchButton').click(function(){
  addImage($("#userName").val());
  $('#images').show();
});
$('#newImage').click(function(){
  ImageGenerator.updateImage();
});
$('#justifyRight').click(function(){
  ImageGenerator.generate("RIGHT");
  $("#justifyLeft").attr('class', 'btn btn-primary');
  $("#justifyRight").attr('class', 'btn btn-primary active');
  $("#justifyCenter").attr('class', 'btn btn-primary');
});
$('#justifyLeft').click(function(){
  ImageGenerator.generate("LEFT");
  $("#justifyLeft").attr('class', 'btn btn-primary active');
  $("#justifyRight").attr('class', 'btn btn-primary');
  $("#justifyCenter").attr('class', 'btn btn-primary');
});
$('#justifyCenter').click(function(){
  ImageGenerator.generate("CENTER");
  $("#justifyLeft").attr('class', 'btn btn-primary');
  $("#justifyRight").attr('class', 'btn btn-primary');
  $("#justifyCenter").attr('class', 'btn btn-primary active');
});


var ImageGenerator = new Object();
ImageGenerator.init = function(tweetText, authorText, imageSrc) {
  this.canvas = document.getElementById("myCanvas");
  this.context = this.canvas.getContext("2d");
  this.imageWidth = 400;
  this.imageHeight = 400;
  this.textPadding = 20;
  this.tweetText = tweetText;
  this.authorText = authorText;
  this.imageSrc = imageSrc;
}
ImageGenerator.generate = function(justify) {
  var _this = this;
  _this.imageObj = new Image();
  this.imageObj.onload = function(){
    _this.context.drawImage(_this.imageObj, 0, 0, _this.imageWidth, _this.imageHeight);
    _this.context.font = "30px Georgia";
    _this.context.fillStyle = "white";

    // Write Text
    wrapText(_this.context, _this.tweetText, _this.textPadding, 60, _this.imageWidth - (_this.textPadding * 2), 35, justify);
    var authorSize = _this.context.measureText(_this.authorText)
    var width = 400 - authorSize.width - (_this.textPadding);
    _this.context.fillText(_this.authorText, width, 380);
  };
  
  _this.imageObj.src = _this.imageSrc; 
}

//todo: have some sort of stack to pull new images from
ImageGenerator.updateImage = function(){
  var _this = this;
  _this.imageObj.src = "https://scontent.cdninstagram.com/hphotos-xtp1/t51.2885-15/s640x640/e35/sh0.08/10518180_382047678671810_695688240_n.jpg"
}

function addImage(username){
  var newImageButton = '';
  $("body").after(newImageButton);
  var tweet = "Wishing you weren't dutch? #itsbecauseurdutch";
  var user = "@imjen";
  var image = "https://scontent.cdninstagram.com/hphotos-xfa1/t51.2885-15/s640x640/e35/sh0.08/11355905_1618613161745444_1921259379_n.jpg";

  ImageGenerator.init(tweet, user, image);
  ImageGenerator.generate("LEFT");
}
// From: http://www.html5canvastutorials.com/tutorials/html5-canvas-wrap-text-tutorial/
function wrapText(context, text, x, y, maxWidth, lineHeight, justify) {
  var words = text.split(' ');
  var line = '';
  for(var n = 0; n < words.length; n++) {
    var testLine = line + words[n] + ' ';
    var metrics = context.measureText(testLine);
    var testWidth = metrics.width;
    if (testWidth > maxWidth && n > 0) {
      context.fillText(line, getX(justify, x, line, context), y);
      line = words[n] + ' ';
      y += lineHeight;
    }
    else {
      line = testLine;
    }
  }
  context.fillText(line, getX(justify, x, line, context), y);
}
function getX(justify, x, line, context){
  switch(justify){
    case "LEFT":
      return x;  
    case "RIGHT":
      return ImageGenerator.imageWidth - x - context.measureText(line).width;         
    case "CENTER":
      return (ImageGenerator.imageWidth - x - context.measureText(line).width) / 2;      
    }
  }

</script>
</body>
</html>